<link rel="import" href="bower_components/polymer/polymer-element.html">

<dom-module id="ink-quote">
  <template>
    <style>
      a {
        color: #1E88E5;
        text-decoration: none;
        font-weight: 500;
      }
      a:hover{
        text-decoration: underline;
      }
      blockquote{
        padding: 10px 20px;
        margin: 20px 0;
        border-left: 5px solid #eee;
        color: #31708f;
        font-size: 17.5px;
        font-weight: 300;
        line-height: 1.25;
        text-align: justify;
      }
      blockquote small{
        display: block;
        line-height: 1.428571429;
        color: #999;
        font-size: 75%;
        text-align: right;
      }
      blockquote small:before {
        content: '\2014 \00A0';
      }
      div{
        margin-top: 10px;
        text-align: right;
        font-style: italic;
      }
    </style>
    <blockquote>
        <slot></slot>
        <div>- <a href="[[ url ]]" target="_blank">[[ author ]]</a> [[ date ]]</div>
    </blockquote>
  </template>

  <script>
    class InkQuote extends Polymer.Element {
      static get is() { return 'ink-quote'; }
      static get properties(){
        return {
          url:{
            type: String
          },
          author:{
            type: String
          },
          date:{
            type: String
          },
          src:{
            type: String,
            observer: 'src_changed'
          }
        };
      }
      src_changed() {
        if(!this.src.startsWith('/api/bricks')){console.log('ink-quote src parameter could not be used.');return;}
        if(this.src === "" | this.src == this._last_src){return;}
        this._last_src = this.src;
        var self = this;
        function httpGetAsync(src, callback){
          var xmlHttp = new XMLHttpRequest();
          xmlHttp.onreadystatechange = function() {
              if(xmlHttp.readyState == 4 & xmlHttp.status == 200){
                  try{
                    var data = JSON.parse(xmlHttp.responseText);
                  }catch(err){
                    return;
                  }
                  self.url = data.url_more;
                  self.author = data.author;
                  self.date = data.date.start;
                  self.textContent = data.quote;
              }
          }
          xmlHttp.open("GET", src, true); // true for asynchronous
          xmlHttp.send();
        }
        httpGetAsync(this.src);
      }
    }
    window.customElements.define(InkQuote.is, InkQuote);
  </script>
</dom-module>
