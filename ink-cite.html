<link rel="import" href="../polymer/polymer-element.html">


<dom-module id="ink-cite">
  <template>
    <style>
      .etal{
        font-style: italic;
      }
    </style>
    <span>([[ people(key, item) ]]<span class="etal">[[ etal ]]</span>, [[ year ]])</span></template>
  <script>
    class InkCite extends Polymer.Element {
      static get is() { return 'ink-cite'; }
      static get properties() {
        return {
          key: {
            type: String
          },
          item: {
            type: Object
          },
          etal: {
            type: String
          },
          year: {
            type: Number
          }
        };
      }
      people(key, item){
        if(!item){return key;}
        var names = item.entryTags.author.split(" and ");
        var name_strings = names.map(name => {
          name = name.trim();
          if (name.indexOf(",") != -1){
            var last = name.split(",")[0].trim();
          } else {
            var last = name.split(" ").slice(-1)[0].trim();
          }
          return last;
        });
        this.etal = '';
        if (names.length > 2) {
          this.etal = ' et al.';
          this.year = item.entryTags.year;
          return name_strings[0];
        }
        if (names.length == 2) {
          this.year = item.entryTags.year;
          return name_strings[0] + ' and ' + name_strings[1];
        }
        this.year = item.entryTags.year;
        return name_strings[0];
      }
    }
    window.customElements.define(InkCite.is, InkCite);
  </script>
</dom-module>
